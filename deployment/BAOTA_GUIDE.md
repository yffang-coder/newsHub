# 宝塔面板 (Baota Panel) 部署指南

本指南将协助您在安装了宝塔面板的腾讯云服务器上部署本项目。

## 1. 准备工作

在宝塔面板的 **软件商店** 中安装以下应用：
1.  **Docker管理器** (必装)：用于管理容器。
    *   在软件商店搜索 "Docker"，找到 "Docker管理器" 并点击安装。
2.  **Nginx** (通常已安装)：用于反向代理和域名管理。

## 2. 部署步骤

### 第一步：上传代码
1.  在宝塔面板左侧点击 **文件**。
2.  进入 `/www/wwwroot` 目录（或者您喜欢的任何目录）。
3.  新建一个文件夹，例如 `blog`。
4.  将本地项目中的所有文件上传到该目录。
    *   **注意**：确保 `deployment` 目录和 `backend` 目录结构保持完整。

### 第二步：配置环境
1.  在文件管理器中，进入 `blog/deployment` 目录。
2.  双击编辑 `.env` 文件，设置您的数据库密码：
    ```
    MYSQL_PASSWORD=您复杂的密码
    ```
    *(如果找不到 .env 文件，部署脚本会自动生成一个，您也可以手动新建)*

### 第三步：执行部署
1.  在宝塔面板左侧点击 **终端**。
2.  输入服务器密码登录终端。
3.  进入部署目录并运行脚本：
    ```bash
    cd /www/wwwroot/blog/deployment
    
    # 赋予脚本执行权限
    chmod +x deploy.sh
    
    # 开始部署
    ./deploy.sh
    ```
4.  等待脚本执行完毕。首次构建可能需要几分钟。

## 3. 访问与域名配置

为了避免与宝塔的默认网站端口冲突，Docker 容器默认运行在 **8090** 端口。

### 核心原理说明（必读）
本项目采用了 **Docker 容器化一体部署**。
*   **前端 UI**：已经打包在 Docker 容器中。
*   **后端 API**：也运行在 Docker 容器中。
*   **Nginx 代理**：Docker 容器内部已经内置了一个 Nginx，它会自动处理：
    *   访问 `/` -> 返回前端 UI 界面。
    *   访问 `/api/` -> 自动转发给后端接口。

**结论**：您在宝塔中**不需要**手动配置 `/api` 的反向代理规则，也不需要单独上传前端 `dist` 文件。您只需要将所有流量转发给 Docker 的 8090 端口即可。

### 方式一：通过 IP 直接访问（测试用）
*   访问：`http://服务器IP:8090`
*   注意：需要在腾讯云控制台的 **防火墙/安全组** 中放行 `TCP:8090` 端口。

### 方式二：配置域名（推荐） - 新增独立站点

**这是最简单且不影响现有配置的方法。**

1.  在宝塔面板点击 **网站** -> **添加站点**。
2.  填写您的新闻项目专用域名（例如 `news.yffxdq.cloud`）。
3.  PHP版本选择 "纯静态" 即可。
4.  提交创建。
5.  点击刚才创建的网站名称，进入 **设置**。
6.  找到 **反向代理** 菜单：
    *   **代理名称**：任意（如 `blog_docker`）
    *   **目标URL**：`http://127.0.0.1:8090`
    *   **发送域名**：`$host`
7.  点击提交。

### 方式三：合并到现有 Nginx 配置文件（仅供参考）

如果您想在同一个域名下（例如通过子路径 `/news/` 访问），这会比较复杂，因为 Docker 容器内的 Vue 路由是基于根路径 `/` 编译的。**强烈建议使用二级域名（方式二）**。

如果您一定要修改主配置文件，请在 `server` 块中添加一个新的 `location`，指向 8090 端口：

```nginx
# 这是一个示例，通常不建议这样做，除非您知道如何修改 Vue 的 base url
# location /news/ {
#     proxy_pass http://127.0.0.1:8090/;
#     ...
# }
```

**最佳实践**：请使用方式二，创建一个新的子域名（如 `news.yffxdq.cloud`），这样完全不会影响您现有的 `yffxdq.cloud` 网站。

---

## 4. 进阶：我不想要 Docker 托管前端怎么办？

如果您希望将前端文件直接放在宝塔的 `/www/wwwroot/` 目录下，仅使用 Docker 运行后端，请按以下步骤操作（**初学者不推荐**）：

1.  **修改 Docker 配置**：编辑 `docker-compose.yml`，注释掉 `frontend` 服务部分。
2.  **本地构建前端**：在本地电脑运行 `npm run build`，得到 `dist` 目录。
3.  **上传文件**：将 `dist` 目录下的所有文件上传到宝塔网站目录（如 `/www/wwwroot/blog.example.com`）。
4.  **配置宝塔 Nginx**：
    在宝塔网站设置 -> **配置文件** 中，添加以下规则以支持 API 转发和 Vue 路由：

    ```nginx
    # 1. 代理后端 API
    location /api/ {
        proxy_pass http://127.0.0.1:8080/api/; # 注意这里是 8080，因为没有前端容器中转
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # 2. 支持 Vue 路由 History 模式（防止刷新 404）
    location / {
        try_files $uri $uri/ /index.html;
    }
