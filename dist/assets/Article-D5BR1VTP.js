import{s as F,d as H,r as b,o as J,c as i,a as e,b as t,E as O,w as r,e as k,t as l,f as K,g as P,h as G,i as q,F as S,j as z,k as y,l as a,u as x,m as Q,n as B,p as W,q as X,v as Y,x as L,y as R,z as Z,A as ee,B as te}from"./index-XMcsf4iL.js";const se=async w=>{try{const u=await F.get(`/comments/article/${w}`);return Array.isArray(u)?u:[]}catch(u){return console.error(`Error fetching comments for article ${w}:`,u),[]}},D=async w=>{try{return await F.post("/comments",w)}catch(u){throw console.error("Error adding comment:",u),u}},oe={class:"mt-12 pt-8 border-t border-border"},le={class:"text-xl font-bold text-primary mb-6 flex items-center gap-2"},re={class:"mb-10 flex gap-4"},ae={class:"w-10 h-10 rounded-full bg-secondary flex-shrink-0 flex items-center justify-center overflow-hidden"},ne={key:1,class:"font-bold text-primary"},de={class:"flex-1"},ie={class:"flex justify-end"},ce={class:"space-y-8"},ue={key:0,class:"text-center py-8 text-muted-foreground"},_e={key:1,class:"text-center py-8 text-muted-foreground"},pe={class:"w-10 h-10 rounded-full bg-muted flex-shrink-0 flex items-center justify-center text-accent font-bold"},fe={class:"flex-1"},me={class:"bg-secondary/30 rounded-lg p-4"},xe={class:"flex justify-between items-start mb-2"},ve={class:"font-bold text-primary text-sm"},he={class:"text-xs text-muted-foreground"},ge={class:"text-foreground/80 text-sm leading-relaxed"},ye={class:"mt-3 flex gap-4"},be=["onClick"],ke={key:0,class:"mt-4 pl-4 border-l-2 border-primary/20"},we={class:"flex justify-end gap-2"},$e={key:0,class:"mt-4 space-y-4 pl-4 border-l-2 border-border ml-2"},Ce={class:"w-8 h-8 rounded-full bg-muted flex-shrink-0 flex items-center justify-center text-xs font-bold text-accent"},Ie={class:"flex-1"},Ee={class:"bg-secondary/20 rounded p-3"},je={class:"flex justify-between items-start mb-1"},Ve={class:"font-bold text-primary text-xs"},qe={class:"text-[10px] text-muted-foreground"},Se={class:"text-foreground/80 text-xs"},ze=H({__name:"CommentSection",props:{articleId:{}},setup(w){const u=w,s=b(localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):null),v=b(""),h=b([]),n=b(!1),$=b(null),p=b(""),g=async()=>{n.value=!0;try{const o=(await se(u.articleId)).map(f=>({...f,user:f.username||"User "+f.userId,date:new Date(f.createdAt).toLocaleString(),likes:0,replies:[]}));h.value=U(o)}catch(c){console.error(c)}finally{n.value=!1}},U=c=>{const o=new Map,f=[];return c.sort((_,C)=>_.id-C.id),c.forEach(_=>{o.set(_.id,_),_.replies=[]}),c.forEach(_=>{_.parentId&&o.has(_.parentId)?o.get(_.parentId).replies.push(_):f.push(_)}),f.reverse()};J(()=>{g()});const A=async()=>{if(!s.value){y.warning("请先登录后再评论");return}if(!v.value.trim()){y.warning("请输入评论内容");return}try{await D({articleId:u.articleId,content:v.value,userId:s.value.id}),y.success("评论发布成功"),v.value="",g()}catch{y.error("评论发布失败")}},j=async c=>{if(!s.value){y.warning("请先登录");return}if(!p.value.trim()){y.warning("请输入回复内容");return}try{await D({articleId:u.articleId,content:p.value,userId:s.value.id,parentId:c}),y.success("回复成功"),p.value="",$.value=null,g()}catch{y.error("回复失败")}};return(c,o)=>{var T;const f=O,_=P,C=G;return a(),i("div",oe,[e("h3",le,[t(f,null,{default:r(()=>[t(x(Q))]),_:1}),k(" 评论 ("+l(h.value.reduce((d,V)=>{var I;return d+1+(((I=V.replies)==null?void 0:I.length)||0)},0))+") ",1)]),e("div",re,[e("div",ae,[s.value?(a(),i("span",ne,l(((T=s.value.username)==null?void 0:T[0])||"U"),1)):(a(),K(f,{key:0,size:20,class:"text-muted-foreground"},{default:r(()=>[t(x(B))]),_:1}))]),e("div",de,[t(_,{modelValue:v.value,"onUpdate:modelValue":o[0]||(o[0]=d=>v.value=d),type:"textarea",rows:3,placeholder:s.value?"写下您的想法...":"请先登录后发表评论",resize:"none",class:"mb-3",disabled:!s.value},null,8,["modelValue","placeholder","disabled"]),e("div",ie,[t(C,{type:"primary",disabled:!s.value,onClick:A},{default:r(()=>[...o[3]||(o[3]=[k("发布评论",-1)])]),_:1},8,["disabled"])])])]),e("div",ce,[n.value?(a(),i("div",ue,"加载中...")):h.value.length===0?(a(),i("div",_e,"暂无评论，快来抢沙发吧！")):q("",!0),(a(!0),i(S,null,z(h.value,d=>{var V,I,M;return a(),i("div",{key:d.id,class:"flex gap-4"},[e("div",pe,l((I=(V=d.user)==null?void 0:V[0])==null?void 0:I.toUpperCase()),1),e("div",fe,[e("div",me,[e("div",xe,[e("span",ve,l(d.user),1),e("span",he,l(d.date),1)]),e("p",ge,l(d.content),1),e("div",ye,[e("button",{class:"text-xs font-medium text-muted-foreground hover:text-primary transition-colors flex items-center gap-1",onClick:m=>{var E;return $.value=((E=$.value)==null?void 0:E.id)===d.id?null:d}},[t(f,null,{default:r(()=>[t(x(W))]),_:1}),o[4]||(o[4]=k(" 回复 ",-1))],8,be)]),((M=$.value)==null?void 0:M.id)===d.id?(a(),i("div",ke,[t(_,{modelValue:p.value,"onUpdate:modelValue":o[1]||(o[1]=m=>p.value=m),type:"textarea",rows:2,placeholder:"回复...",class:"mb-2"},null,8,["modelValue"]),e("div",we,[t(C,{size:"small",onClick:o[2]||(o[2]=m=>$.value=null)},{default:r(()=>[...o[5]||(o[5]=[k("取消",-1)])]),_:1}),t(C,{type:"primary",size:"small",onClick:m=>j(d.id)},{default:r(()=>[...o[6]||(o[6]=[k("发表回复",-1)])]),_:1},8,["onClick"])])])):q("",!0)]),d.replies&&d.replies.length>0?(a(),i("div",$e,[(a(!0),i(S,null,z(d.replies,m=>{var E,N;return a(),i("div",{key:m.id,class:"flex gap-3"},[e("div",Ce,l((N=(E=m.user)==null?void 0:E[0])==null?void 0:N.toUpperCase()),1),e("div",Ie,[e("div",Ee,[e("div",je,[e("span",Ve,l(m.user),1),e("span",qe,l(m.date),1)]),e("p",Se,l(m.content),1)])])])}),128))])):q("",!0)])])}),128))])])}}}),Ue={key:0,class:"container-width py-12 text-center"},Ae={key:1,class:"container-width py-12"},Be={class:"max-w-4xl mx-auto mb-12 text-center"},Te={class:"flex items-center justify-center gap-2 text-sm font-medium mb-6"},Me={class:"text-accent uppercase tracking-wider"},Ne={class:"text-muted-foreground"},Le={class:"text-4xl md:text-5xl font-bold leading-tight text-primary mb-8"},Re={class:"text-xl text-muted-foreground leading-relaxed max-w-2xl mx-auto"},De={key:0,class:"aspect-video w-full overflow-hidden rounded-xl mb-12 bg-muted"},Fe=["src","alt"],He={class:"grid grid-cols-1 lg:grid-cols-12 gap-12"},Je={class:"hidden lg:block lg:col-span-2 space-y-8 sticky top-24 h-fit"},Oe={class:"text-center"},Ge={class:"w-16 h-16 bg-secondary rounded-full mx-auto mb-3 flex items-center justify-center text-muted-foreground"},Ke={class:"font-bold text-primary"},Pe={class:"text-xs text-muted-foreground"},Qe={class:"flex flex-col gap-3"},We={class:"lg:col-span-8"},Xe={class:"lg:hidden flex items-center justify-between mb-8 border-b border-border pb-6"},Ye={class:"flex items-center gap-3"},Ze={class:"w-10 h-10 bg-secondary rounded-full flex items-center justify-center text-muted-foreground"},et={class:"font-bold text-primary text-sm"},tt={class:"text-xs text-muted-foreground"},st={class:"flex gap-2"},ot=["innerHTML"],lt={class:"mt-12 pt-8 border-t border-border"},rt={class:"flex flex-wrap gap-2"},at={class:"lg:col-span-2 space-y-6"},nt={class:"space-y-4"},dt={key:2,class:"container-width py-12 text-center"},ct=H({__name:"Article",setup(w){const u=Y(),s=b(null),v=b(!0);return J(async()=>{const h=u.params.id;if(h)try{s.value=await X(h)}catch(n){console.error("Failed to fetch article:",n)}finally{v.value=!1}}),(h,n)=>{var j;const $=ee,p=O,g=G,U=Z,A=te;return v.value?(a(),i("div",Ue,[t($,{rows:10,animated:""})])):s.value?(a(),i("article",Ae,[e("header",Be,[e("div",Te,[e("span",Me,l(s.value.category),1),n[0]||(n[0]=e("span",{class:"text-muted-foreground"},"•",-1)),e("span",Ne,l(s.value.date)+" "+l(s.value.time),1)]),e("h1",Le,l(s.value.title),1),e("p",Re,l(s.value.excerpt),1)]),s.value.image?(a(),i("div",De,[e("img",{src:s.value.image,alt:s.value.title,class:"w-full h-full object-cover"},null,8,Fe)])):q("",!0),e("div",He,[e("aside",Je,[e("div",Oe,[e("div",Ge,[t(p,{size:32},{default:r(()=>[t(x(B))]),_:1})]),e("div",Ke,l(s.value.author),1),e("div",Pe,l(s.value.authorRole),1)]),e("div",Qe,[t(g,{round:"",class:"w-full !ml-0"},{default:r(()=>[t(p,{class:"mr-2"},{default:r(()=>[t(x(L))]),_:1}),n[1]||(n[1]=k(" 分享 ",-1))]),_:1}),t(g,{round:"",class:"w-full !ml-0"},{default:r(()=>[t(p,{class:"mr-2"},{default:r(()=>[t(x(R))]),_:1}),n[2]||(n[2]=k(" 收藏 ",-1))]),_:1})])]),e("div",We,[e("div",Xe,[e("div",Ye,[e("div",Ze,[t(p,{size:20},{default:r(()=>[t(x(B))]),_:1})]),e("div",null,[e("div",et,l(s.value.author),1),e("div",tt,l(s.value.authorRole),1)])]),e("div",st,[t(g,{circle:""},{default:r(()=>[t(p,null,{default:r(()=>[t(x(L))]),_:1})]),_:1}),t(g,{circle:""},{default:r(()=>[t(p,null,{default:r(()=>[t(x(R))]),_:1})]),_:1})])]),e("div",{class:"prose prose-lg max-w-none prose-headings:font-bold prose-headings:tracking-tight prose-headings:text-primary prose-p:text-muted-foreground prose-p:leading-relaxed prose-a:text-accent prose-a:no-underline hover:prose-a:underline prose-blockquote:border-l-4 prose-blockquote:border-accent prose-blockquote:bg-secondary/30 prose-blockquote:py-2 prose-blockquote:px-4 prose-blockquote:rounded-r-lg prose-blockquote:not-italic prose-img:rounded-xl",innerHTML:s.value.content},null,8,ot),e("div",lt,[e("div",rt,[(a(),i(S,null,z(["气候变化","巴黎协定","碳中和","联合国"],c=>t(U,{key:c,effect:"dark",type:"info",class:"!bg-secondary !text-secondary-foreground !border-none cursor-pointer hover:opacity-80"},{default:r(()=>[k(" #"+l(c),1)]),_:2},1024)),64))])]),t(ze,{"article-id":((j=s.value)==null?void 0:j.id)||0},null,8,["article-id"])]),e("aside",at,[n[4]||(n[4]=e("h3",{class:"font-bold text-primary border-b border-border pb-2"},"相关阅读",-1)),e("div",nt,[(a(),i(S,null,z(3,c=>e("div",{key:c,class:"block group cursor-pointer"},[...n[3]||(n[3]=[e("span",{class:"text-xs text-accent block mb-1"},"国际",-1),e("h4",{class:"text-sm font-medium leading-snug group-hover:text-primary/70 transition-colors"}," 欧盟提出新的环保法案，限制一次性塑料制品的使用 ",-1)])])),64))])])])])):(a(),i("div",dt,[t(A,{description:"文章未找到"})]))}}});export{ct as default};
