import{e as U,f as k,u as B}from"./admin-Bu59Y2qZ.js";import{d as D,o as V,c as A,a as o,b as a,w as l,k as r,h as T,ab as M,r as h,l as w,e as m,aj as N,ak as S,f as z,af as j,a2 as I,t as i,ao as L,ah as R,u as $,am as O,an as q,ae as F}from"./index-XMcsf4iL.js";const G={class:"space-y-6"},H={class:"flex items-center justify-between"},J={class:"flex items-center gap-3"},K={class:"flex flex-col"},P={class:"font-medium text-primary"},Q={class:"text-xs text-muted-foreground"},Z=D({__name:"Users",setup(W){const f=h([]),_=h(!1),c=async()=>{_.value=!0;try{const t=await U();f.value=t}catch{r.error("获取用户列表失败")}finally{_.value=!1}},b=t=>{q.confirm(`确定要删除用户 "${t.username}" 吗? 此操作无法撤销。`,"警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await k(t.id),r.success("用户已删除"),c()}catch{r.error("删除失败")}}).catch(()=>{})},x=async(t,s)=>{try{await B(t.id,s),r.success("权限已更新"),t.role=s}catch{r.error("更新失败"),c()}};return V(()=>{c()}),(t,s)=>{const u=T,n=j,y=I,p=R,v=L,g=F,C=M,E=S;return w(),A("div",G,[o("div",H,[s[1]||(s[1]=o("h2",{class:"text-2xl font-bold text-primary"},"用户管理",-1)),a(u,{type:"primary",onClick:c},{default:l(()=>[...s[0]||(s[0]=[m("刷新列表",-1)])]),_:1})]),a(C,{shadow:"hover",class:"!border-none"},{default:l(()=>[N((w(),z(g,{data:f.value,style:{width:"100%"}},{default:l(()=>[a(n,{prop:"id",label:"ID",width:"80"}),a(n,{label:"用户"},{default:l(e=>[o("div",J,[a(y,{size:32,class:"bg-secondary text-primary"},{default:l(()=>[m(i(e.row.username[0].toUpperCase()),1)]),_:2},1024),o("div",K,[o("span",P,i(e.row.username),1),o("span",Q,i(e.row.email),1)])])]),_:1}),a(n,{prop:"role",label:"角色",width:"150"},{default:l(e=>[a(v,{modelValue:e.row.role,"onUpdate:modelValue":d=>e.row.role=d,size:"small",onChange:d=>x(e.row,d),disabled:e.row.username==="admin"},{default:l(()=>[a(p,{label:"普通用户",value:"USER"}),a(p,{label:"管理员",value:"ADMIN"})]),_:1},8,["modelValue","onUpdate:modelValue","onChange","disabled"])]),_:1}),a(n,{prop:"createdAt",label:"注册时间",width:"180"},{default:l(e=>[m(i(new Date(e.row.createdAt).toLocaleDateString()),1)]),_:1}),a(n,{label:"操作",width:"120",fixed:"right"},{default:l(e=>[a(u,{type:"danger",size:"small",circle:"",icon:$(O),disabled:e.row.username==="admin",onClick:d=>b(e.row)},null,8,["icon","disabled","onClick"])]),_:1})]),_:1},8,["data"])),[[E,_.value]])]),_:1})])}}});export{Z as default};
